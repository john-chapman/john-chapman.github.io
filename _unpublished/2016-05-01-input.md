---
layout: post
title: Input
date: 2016-03-02
published: true
tags: c++, input, raw, WM_INPUT
---

#Input
Input handling for realtime applications is not really as simple as it may at first seem.
Aside from the inconsistent OS-specific APIs and the variable nature of input
hardware (different keyboard/gamepad layouts), there are also a number of subtle
design issues which, if ignored, can lead to an incorrect input model and a buggy 
application.

In this post I'm going to talk about the design considerations for a high-level
input model. In the next post I'll move on to discuss implementing realtime input 
for keyboard, mouse and gamepad devices on Windows using the 'Raw Input' API. 

So let's dive right in. Where does an application get its input from?

##Events vs. Polling
At the lowest level the operating system interacts with hardware devices using
hardware interrupts and direct polling to generate input data for consumption by
the application. The application itself can only receive input via the OS (or
a higher abstraction layer).

The input interface varies between operating systems: on Windows applications will
typically handle events like `WM_KEYDOWN` and `WM_MOUSEMOVE` which correspond to
input 'events'. The operating system might also give the impression that you can 
poll a device directly, for example the `GetAsyncKeyState()` API, but this is 
really only an illusion. 

Polling input via a function like `GetAsyncKeyState()` seems very simple - we 
simply capture the instantatneous state of a button and perform some action based 
on that state. There is, however, a subtle pitfall in this approach:

	t0    t1    t2    t3 <- calls to GetAsyncKeyState()
	   ^  ^  ^      ^ ^  <- actual user actions
	   
In this case, at each poll of the device state we only see the last state which
was recorded. In practice this means that we could potentially miss key presses
which happen *between* calls to the polling function. Perhaps this will only
be problematic if the frequency of calls is very low (e.g. if our framerate 
drops), but it's something that a realtime application should provide against 
and, in fact, we can do better.

 

Logical design (Device, per-frame update).

Implementation using RAW_INPUT